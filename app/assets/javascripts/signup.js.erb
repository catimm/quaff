$(function() {
	// set delay function
	var delay = (function(){
	  var timer = 0;
	  return function(callback, ms){
	    clearTimeout (timer);
	    timer = setTimeout(callback, ms);
	  };
	})();
	
	// find width of tile so overlay matches
	var like_tile_width = $('.signup-style-tile.like-style-tile').width();
	$('.signup-style-tile.like-style-tile.chosen').width(like_tile_width);
	var dislike_tile_width = $('.signup-style-tile.dislike-style-tile').width();
	$('.signup-style-tile.dislike-style-tile.chosen').width(dislike_tile_width);
				
	// for rating slider
	$("#signup_delivery_preference_new_percentage").slider({
		tooltip: 'hide'
	});
	
	// add logic to change background color of image chosen and send data to controller
	$(document).on('click', '.signup-category-image-holder', function () {
		$(this).siblings('.signup-category-image-holder-chosen-cover').removeClass('hidden').addClass('show');
		$(this).parent().siblings('.signup-category-image-holder-parent').children('.signup-category-image-holder-chosen-cover').removeClass('show').addClass('hidden');
		
		var id_info = $(this).attr('id');
		var id_split = id_info.split('-');
		var choice = id_split[0];
		var current_page = id_split[1];
		
		if (choice == "beer") {
			var new_value = 1
		} else if (choice == "cider") {
			var new_value = 2
		} else {
			var new_value = 3
		}
		
		if(current_page == "signup") {
			var controller_url = "/signup/process_input/category-irrelevant-" + new_value
		} else {
			var controller_url = "/users/deliveries_update_preferences/drink_type_preference-" + new_value
		}
		
		// send data to controller
		$.ajax({
		  type: "POST",
		  url: controller_url
		});
		
	});
	
	$(document).on('click', '.signup-journey-image-holder', function () {
		$(this).siblings('.signup-journey-image-holder-chosen-cover').removeClass('hidden').addClass('show');
		$(this).parent().siblings('.signup-journey-image-holder-parent').children('.signup-journey-image-holder-chosen-cover').removeClass('show').addClass('hidden');
		
		var id_info = $(this).attr('id');
		var id_split = id_info.split('-');
		var choice = id_split[0];
		var current_page = id_split[1];
		
		if (choice == "casual") {
			var new_value = 1
		} else if (choice == "geek") {
			var new_value = 2
		} else {
			var new_value = 3
		}
		
		if(current_page == "signup") {
			var controller_url = "/signup/process_input/journey-irrelevant-" + new_value
		} else {
			var controller_url = "/users/deliveries_update_preferences/craft_journey-" + new_value
		}
		
		// send data to controller
		$.ajax({
		  type: "POST",
		  url: controller_url
		});
		
	});
	
	// add logic to change background color of number boxes and send data to controller
	$(document).on('click', '.number-box-holder.weekly-drinks', function () {
		$(this).addClass('chosen');
		$(this).parent().siblings('.number-box-holder-parent').children('.number-box-holder').removeClass('chosen');
		
		var id_info = $(this).attr('id');
		var id_split = id_info.split('-');
		var drinks_per_week = id_split[0];
		var current_page = id_split[1];
		
		if(current_page == "signup") {
			var controller_url = "/signup/process_input/preferences-1-" + drinks_per_week
		} else {
			var controller_url = "/users/deliveries_update_preferences/drinks_per_week-" + drinks_per_week
		}
		 
		// send data to controller
		$.ajax({
		  type: "POST",
		  url: controller_url
		});
		
	});
	
	$(document).on('click', '.signup-plan-start-holder', function () {
		$(this).siblings('.signup-plan-start-holder-chosen-cover').removeClass('hidden').addClass('show');
		$(this).parent().siblings('.signup-plan-start-holder-parent').children('.signup-plan-start-holder-chosen-cover').removeClass('show').addClass('hidden');
		
		var id_info = $(this).attr('id');
		var id_split = id_info.split('-');
		var start_choice = id_split[0];
		var current_page = id_split[1];
		
		if(current_page == "signup") {
			var controller_url = "/signup/process_input/account-2-" + start_choice
		} else {
			var controller_url = "/users/deliveries_update_preferences/start_date-" + start_choice
		}
		
		// send data to controller
		$.ajax({
		  type: "POST",
		  url: controller_url
		});
		
	});
	
	// add logic to change background color of number boxes and send data to controller
	$(document).on('click', '.number-box-holder.large-format', function () {
		$(this).addClass('chosen');
		$(this).parent().siblings('.number-box-holder-parent').children('.number-box-holder').removeClass('chosen');
		
		var id_info = $(this).attr('id');
		var id_split = id_info.split('-');
		var large_format = id_split[0];
		var current_page = id_split[1];
		
		if(current_page == "signup") {
			var controller_url = "/signup/process_input/preferences-2-" + large_format
		} else {
			var controller_url = "/users/deliveries_update_preferences/large_format-" + large_format
		}
		
		// send data to controller
		$.ajax({
		  type: "POST",
		  url: controller_url
		});
		
	});
	
	// send new percentage info to controller
	$("#signup_delivery_preference_new_percentage").on("change", function(slideEvt) {
		new_value = slideEvt.value.newValue;
		var repeat_value = (100 - new_value);
		$("#new-preference").text(new_value);
		$("#repeat-preference").text(repeat_value);	
	    
		// send data to controller
		delay(function(){
			$.ajax({
			  type: "POST",
			  url: "/signup/process_input/preferences-3-" + new_value
			});
	    }, 1000 );
	});
	
	// keep track of how many styles have been chosen
	var styles_liked = gon.number_of_liked_styles;
	var styles_disliked = gon.number_of_disliked_styles;
	
	// add logic to change background color of style chosen and send data to controller
	$(document).on('click', '.signup-style-tile.like-style-tile', function () {
		if($(this).siblings('.signup-style-tile.like-style-tile.chosen').hasClass('hidden')) {
			if(styles_liked <= 5) {
				styles_liked = styles_liked + 1;
			}
			if(styles_liked == 1) {
				$("#liked_styles_next_step_button").removeAttr('disabled');
				$("#liked_styles_next_step_button").addClass('btn-success');
			}
			if(styles_liked <= 5) {
				// display number of liked styles
				$("#number_of_liked_styles").html(styles_liked);
				// find width of tile so overlay matches
				var original_tile_width = $(this).width();
				$(this).siblings('.signup-style-tile.like-style-tile.chosen').width(original_tile_width);
				$(this).siblings('.signup-style-tile.like-style-tile.chosen').removeClass('hidden').addClass('show');
				
				var style_id = $(this).attr('id');
				
				// send data to controller
				$.ajax({
				  type: "POST",
				  url: "/signup/process_style_input/like-add-" + style_id
				});
			} else {
				styles_liked = styles_liked - 1;
				alert("You can only choose 5!");
			}
		} else {
			styles_liked = styles_liked - 1;
			// display number of liked styles
			$("#number_of_liked_styles").html(styles_liked);
			
			$(this).removeClass('show').addClass('hidden');
			
			var style_id = $(this).attr('id');
			
			// send data to controller
			$.ajax({
			  type: "POST",
			  url: "/signup/process_style_input/like-remove-" + style_id
			});
			
			// remove button functionality if fewer than one like
			if(styles_liked < 1) {
				$("#liked_styles_next_step_button").attr('disabled', 'disabled');
				$("#liked_styles_next_step_button").removeClass('btn-success');
			}
		}
	});
	
	$(document).on('click', '.signup-style-tile.dislike-style-tile', function () {
		if($(this).siblings('.signup-style-tile.dislike-style-tile.chosen').hasClass('hidden')) {
			if(styles_disliked <= 5) {
				styles_disliked = styles_disliked + 1;
			}
			if(styles_disliked <= 5) {
				// display number of liked styles
				$("#number_of_disliked_styles").html(styles_disliked);
				// find width of tile so overlay matches
				var original_tile_width = $(this).width();
				$(this).siblings('.signup-style-tile.dislike-style-tile.chosen').width(original_tile_width);
				$(this).siblings('.signup-style-tile.dislike-style-tile.chosen').removeClass('hidden').addClass('show');
				
				var style_id = $(this).attr('id');
				
				// send data to controller
				$.ajax({
				  type: "POST",
				  url: "/signup/process_style_input/dislike-add-" + style_id
				});
			} else {
				styles_disliked = styles_disliked - 1;
				alert("You can only choose 5!");
			}
		} else {
			styles_disliked = styles_disliked - 1;
			// display number of disliked styles
			$("#number_of_disliked_styles").html(styles_disliked);
			
			$(this).removeClass('show').addClass('hidden');
			
			var style_id = $(this).attr('id');
			
			// send data to controller
			$.ajax({
			  type: "POST",
			  url: "/signup/process_style_input/dislike-remove-" + style_id
			});

		}
	});
});