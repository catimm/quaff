$(function() {
	// set height of draft row padding
	top_row_height = $(".draft-edit-top-row-container").height();
	$(".draft-filler-top-row").css('padding-top', top_row_height);
	//$(".draft-edit-top-row-container").next().addClass('top_row_height');

	
	// check if add new draft button has .fields siblings
	if ($("#add-drink-button").prev().hasClass("fields")) {
		field_width = $(".fields").width();
		$(".draft-edit-top-row-container").width(field_width);
	} else {
		//$("#add-drink-button").css('margin-top', top_row_height);
		field_width = $(".draft-board-container").width() - 30;
		$(".draft-edit-top-row-container").width(field_width);
	}
	// count number of drink sizes in each row & adjust drink size count
	$(document).on('click', '.formButton-add-details.add_nested_fields', function () {
	    var siblings = 0
	    $(this).siblings().each(function() {
	    	if ($(this).css('display') != 'none') {
    			siblings++;
    			if(siblings == 1) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("1st size option");
    			}
    			if(siblings == 2) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("2nd size option");
    			}
    			if(siblings == 3) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("3rd size option");
    			}
    			if(siblings == 4) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("4th size option");
    			}
    			if(siblings == 5) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("5th size option");
    			}
			}
	    });
	    if (siblings >= 5) {
	    	$('.formButton-add-details.add_nested_fields').hide();
	    } 
	});
	$(document).on('click', '.remove_nested_fields', function () {
	    var siblings = 0
	    $(this).parent().parent().parent().siblings().each(function(value) {
	    	if ($(this).css('display') != 'none') {
    			siblings++;
    			if(siblings == 1) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("1st size option");
    			}
    			if(siblings == 2) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("2nd size option");
    			}
    			if(siblings == 3) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("3rd size option");
    			}
    			if(siblings == 4) {
    				$(this).children(".draft-details-row").children(".size-option-text-holder").children(".size-option-text").html("4th size option");
    			}
			}
	    });
	    if (siblings <= 4) {
	    	$(this).parent().parent().parent().siblings('.formButton-add-details.add_nested_fields').show();
	    } 
	});
	// count number of drinks loaded
	$(document).on('click', '.formButton-add-draft.add_nested_fields', function () {
	    var siblings = 0
	    $(this).siblings().each(function() {
		    if ($(this).hasClass('fields')) {
		    	if ($(this).css('display') != 'none') {
	    			siblings++;
	    			$(this).children(".new-draft-row").children(".tap-number-holder").children("input").val(siblings);
				}
			}
	    });
	});
	// get unique id of edit form search box when it comes into focus; then send it to the controller to store in session variable
	$(document).on('keydown', '.form-control.typeahead.retailer-search.tt-input.edit-form', function(e) {
	//$('.form-control.typeahead.retailer-search.tt-input').on('keydown', function(e) {
		var inputID;
		var inputID = $(e.target).attr('id');
		//alert(inputID);
		$.ajax({
	    	url : "/draft_boards/edit",
	        data : {inputID: inputID},
		    type : "get"
		});
	});	
	
	// get unique id of new form search box when it comes into focus; then send it to the controller to store in session variable
	$(document).on('keydown', '.form-control.typeahead.retailer-search.tt-input.new-form', function(e) {
	//$('.form-control.typeahead.retailer-search.tt-input').on('keydown', function(e) {
		var inputID;
		var inputID = $(e.target).attr('id');
		//alert(inputID);
		$.ajax({
	    	url : "/draft_boards/new",
	        data : {inputID: inputID},
		    type : "get"
		});
	});
	
	// set height of second draft row if top draft row is deleted
	$(document).on('nested:fieldRemoved', function(event){
	});
	
	// when new fields are added
	$(document).on('nested:fieldAdded', function(event){
		// bind autonumeric javascript each time a new drink details row is added
		$(document).trigger('refresh_autonumeric');
		
	});	
	
	// add logic for quick swap
	$(document).on('click', '.quick-swap-button', function () {
		// remove other row highlights if already highlighted
		if ($('tr').hasClass('swap_chosen')) {
			$('.swap_chosen').removeClass('swap_chosen');
		}
		if ($('tr').hasClass('swap_option')) {
			$('.swap_option').removeClass('swap_option');
		}
		
		// get tap number of the row chosen & add a chosen highlight to it
		//var tap_number = $(this).parent().data("tap");
		//$(this).parent().parent().addClass("swap_chosen");
		
		// get tap numbers of inventory predesignated for a specific tap
		//var current_inventory_tap_array = [];
		//$(".current-inventory-table").children().children(".swap-button-holder").each(function() {;
		//  if ($(this).data("tap") !== 0) {
		//  	current_inventory_tap_array.push($(this).data("tap"));
		//  }
		//});
		//var unique_tap_array = GetUnique(current_inventory_tap_array);
			
		// highlight available options to swap with	
		//if ($(this).parent().parent().parent().hasClass("current-draft-table")){
		//	if($.inArray(tap_number, unique_tap_array) !== -1) {
		//		$(".current-inventory-table").children().children("td[data-tap='" + tap_number + "']").parent().addClass("swap_option");
		//	} else {
		//		$(".current-inventory-table").children().children("td[data-tap='0']").parent().addClass("swap_option");
		//	}
		//} else if ($(this).parent().parent().parent().hasClass("current-inventory-table") ) {
		//	if($.inArray(tap_number, unique_tap_array) !== -1) {
		//		$(".current-draft-table").children().children("td[data-tap='" + tap_number + "']").parent().addClass("swap_option");
		//	} else {
		//		$(".current-draft-table").children().children(".swap-button-holder").each(function() {
		//			if($.inArray($(this).data("tap"), unique_tap_array) === -1) {
		//				$(this).parent().addClass("swap_option");
		//			}
		//		});
				//$(".current-draft-table").children().children("td[data-tap='0']").parent().addClass("swap_option");
		//	}
		//}
		
		// prevent page from jumping to the top after click event
		//return false;
	});
	$(document).on('click', 'body', function () {
		if ($('tr').hasClass('swap_chosen')) {
			$('.swap_chosen').removeClass('swap_chosen');
		}
		if ($('tr').hasClass('swap_option')) {
			$('.swap_option').removeClass('swap_option');
		}
	});
	
	// function for unique arrays
	//function GetUnique(inputArray) {
	//	var outputArray = [];
	//	for (var i = 0; i < inputArray.length; i++)
	//	{
	//		if ((jQuery.inArray(inputArray[i], outputArray)) == -1)
	//		{
	//			outputArray.push(inputArray[i]);
	//		}
	//	}
	//	return outputArray;
	//}

});