$(function () {
	// show modal to confirm delivery request was made 
	if (gon.delivery_request == true) {
		$(window).load(function(){
	        $('#delivery_request_settings_confirmation').modal('show');
	    });
	}
	
	// show modal for 2nd step of settings for those with a new plan  
	if (gon.new_plan_step_two == true) {
		$(window).load(function(){
	        $('#new_plan_step_two').modal('show');
	    });
	}
	$(document).on("scroll", function() {
	    var second_row = $("#second-delivery-row").width();
	    //moveScroller();
	    if ($(window).scrollTop() > 120) {
	    	$("#scroller-anchor").addClass("fixed-delivery-preferences-row");
		    $("#scroller-anchor").width(second_row);
	    } else {
	    	$("#scroller-anchor").removeClass("fixed-delivery-preferences-row");
	    }
	});

	// hide spinner
	$(".spinner").hide();
	
	
  // show spinner on AJAX start
  $(document).ajaxStart(function(){
    $(".spinner").show();
  });

  // hide spinner on AJAX stop
  $(document).ajaxStop(function(){
    $(".spinner").hide();
  });
	  
	
	// set delay function
	var delay = (function(){
	  var timer = 0;
	  return function(callback, ms){
	    clearTimeout (timer);
	    timer = setTimeout(callback, ms);
	  };
	})();
	
	// add review end countdown clock
	$('#review-ends-on').countdown({until: gon.review_period_ends, format: 'dhmS',
										labels: ['Yr', 'Mo', 'Wk', 'Days', 'Hours', 'Mins', 'Secs'],
										labels1: ['Yr', 'Mo', 'Wk', 'Day', 'Hour', 'Min', 'Sec']
									});
	
	// add logic to change delivery date
	$(document).on('click', '.delivery-date-change-row', function () {
		$(this).addClass('chosen');
		$(this).parent().siblings('.delivery-date-change-row-holder').children('.delivery-date-change-row').removeClass('chosen');
		
		var week_number = $(this).attr('id');
		week_number = $.trim(week_number);
		
		$("#confirm-date-change-button").attr("href", "/delivery_settings/change_next_delivery_date/" + week_number);
		
	});
							    
	// ensure only one delivery date option is chosen
	$(document).on("change", ".first_delivery_date_chosen", function() {
		$(this).parent().siblings(".drink-preference-choice").children("input").removeAttr('checked');
	});
	
	// set width of quantity holder--in supply and delivery review views--equal to portion of tile width
	drink_tile_width = $(".drink-tile-width-measurement").width();
	quantity_holder_width = (drink_tile_width * .15);
	$(".quantity-holder").width(quantity_holder_width).height(quantity_holder_width);
	
	$(document).on("click", ".subtract-drink-confirmation-delivery-review", function() {
		var drink_id = $(this).attr('id');
		
		// remove drink tile
		$('#drink-tile-' + drink_id).remove();
		
		// remove modal
	    $('#remove_drink_confirmation_delivery_review').modal('hide');
		
		// send to controller to change database 
		$.ajax({
		  type: "POST",
		  url: "/deliveries/remove_delivery_drink_quantity/" + drink_id
		});
		// make page not jump to top
		return false;
	});
	
	// add logic to change delivery frequency
	$(document).on('click', '.delivery-frequency-holder', function () {
		var week_number = $(this).attr('id');
		
		// send to controller to change database 
		$.ajax({
		  type: "POST",
		  url: "/signup/process_delivery_frequency_getting_started/" + week_number
		});
	});
	
	// allow user to save additional delivery preferences info once they start typing
	$(document).on("keyup", ".delivery-additional-request-form", function() {
		$("#update_delivery_request_button").removeAttr('disabled');
		$("#update_delivery_request_button").addClass('btn-success');
	});
	// show/hide subtotal and sales tax on user delivery stats
	$(document).on("click", ".show-more-price-info", function() {
		$(this).removeClass("show").addClass("hidden");
		$(this).siblings(".delivery-info-box.subtotal").removeClass("hidden").addClass("show");
		$(this).siblings(".delivery-info-box.sales-tax").removeClass("hidden").addClass("show");
		$(this).siblings(".show-less-price-info").removeClass("hidden").addClass("show");
	});
	$(document).on("click", ".show-less-price-info", function() {
		$(this).removeClass("show").addClass("hidden");
		$(this).siblings(".delivery-info-box.subtotal").removeClass("show").addClass("hidden");
		$(this).siblings(".delivery-info-box.sales-tax").removeClass("show").addClass("hidden");
		$(this).siblings(".show-more-price-info").removeClass("hidden").addClass("show");
	});
	
	// allow user to see delivery estimates for full account and all account users
	$(document).on("click", ".user-initial-holder-for-estimates", function() {
		// change buttons view
		$(".user-initial-holder-for-estimates").removeClass("inverse");
		$(".user-initial-holder-for-estimates").addClass("inverse");
		$(this).removeClass("inverse");
		if (!$("#account-estimate-button").hasClass("inverse")) {
			$("#account-estimate-button").addClass("inverse");
		}
		// get user id of view chosen
		var user_id_data = $(this).attr('id');
		var user_id_data_split = user_id_data.split('-');
		var user_id = user_id_data_split[2];
		// show appropriate estimate
		if ($("#user-account").hasClass("show")) {
			$("#user-account").removeClass("show").addClass("hidden");
		}
		$(".mates-preferences-holder").removeClass("show").removeClass("hidden").addClass("hidden");
		$("#user-" + user_id).removeClass("hidden").addClass("show");
	});
	// allow user to see delivery estimates for full account and all account users
	$(document).on("click", "#account-estimate-button", function() {
		// change buttons view
		$(this).removeClass("inverse");
		$(".user-initial-holder-for-estimates").removeClass("inverse");
		$(".user-initial-holder-for-estimates").addClass("inverse");
		// show account estimate
		$(".mates-preferences-holder").removeClass("show").removeClass("hidden").addClass("hidden");
		$("#user-account").removeClass("hidden").addClass("show");
	});
});