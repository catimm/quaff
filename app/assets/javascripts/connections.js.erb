$(function () {

	// hide spinner
	$(".spinner").hide();
	
	
  	// show spinner on AJAX start
	$(document).ajaxStart(function(){
	  $(".spinner").show();
	});
	
	// hide spinner on AJAX stop
	$(document).ajaxStop(function(){
	  $(".spinner").hide();
	});
	  
	// set delay function
	var delay = (function(){
	  var timer = 0;
	  return function(callback, ms){
	    clearTimeout (timer);
	    timer = setTimeout(callback, ms);
	  };
	})();

	// search for friends to add
	$(document).on("keyup", ".friend-search", function() {
		value = $(this).val();
		delay(function(){
			$.ajax({
			  type: "GET",
			  url: "/connections/friend_search/1/" + value
			});
	    }, 500 );
	});

	// change friend status
	$(document).on("click", ".friend-response.add", function() {
		var value = $(this).parent(".col-xs-2.no-padding").parent(".row.no-margin").parent(".friend-search-tile").parent(".friend-tile-container").attr('id');
		var value_split = value.split("-");
		var friend_id = value_split[2];
		
		if(window.location.href.indexOf("manage_friends") > -1) {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes/invitor-add-" + friend_id
				});
		} else {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes_on_find_page/invitor-add-" + friend_id
				});
		}
	});
	$(document).on("click", ".friend-response.drop", function() {
		var value = $(this).parent(".col-xs-2.no-padding").parent(".row.no-margin").parent(".friend-search-tile").parent(".friend-tile-container").attr('id');
		var value_split = value.split("-");
		var friend_id = value_split[2];
		
		if(window.location.href.indexOf("manage_friends") > -1) {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes/invited-drop-" + friend_id
				});
		} else {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes_on_find_page/invited-drop-" + friend_id
				});
		}
	});
	$(document).on("click", ".friend-response.pending.drop", function() {
		var value = $(this).parent(".col-xs-2.no-padding").parent(".row.no-margin").parent(".friend-search-tile").parent(".friend-tile-container").attr('id');
		var value_split = value.split("-");
		var friend_id = value_split[2];
		
		if(window.location.href.indexOf("manage_friends") > -1) {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes/invited-drop-" + friend_id
				});
		} else {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes_on_find_page/invited-drop-" + friend_id
				});
		}
	});
	$(document).on("click", ".add-friend", function() {
		var value = $(this).parent(".friend-response.pending.invite").parent(".col-xs-2.no-padding").parent(".row.no-margin").parent(".friend-search-tile").parent(".friend-tile-container").attr('id');
		var value_split = value.split("-");
		var friend_id = value_split[2];
		
		if(window.location.href.indexOf("manage_friends") > -1) {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes/invited-add-" + friend_id
				});
		} else {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes_on_find_page/invited-add-" + friend_id
				});
		}
	});
	$(document).on("click", ".decline-friend", function() {
		var value = $(this).parent(".friend-response.pending.invite").parent(".col-xs-2.no-padding").parent(".row.no-margin").parent(".friend-search-tile").parent(".friend-tile-container").attr('id');
		var value_split = value.split("-");
		var friend_id = value_split[2];
		
		if(window.location.href.indexOf("manage_friends") > -1) {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes/invited-drop-" + friend_id
				});
		} else {
			$.ajax({
				  type: "POST",
				  url: "/connections/process_friend_changes_on_find_page/invited-drop-" + friend_id
				});
		}
	});
	
});