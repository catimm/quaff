<%= render 'layouts/header' %> 
<div class="row no-margin first-row">
		<div class="container first-row-container">
			<div class="col-xs-12">
				<h1 class="section-header">Delivery Settings</h1>
			</div>
			<div class="col-xs-12 col-sm-7">
				<div class="row">
					<% if session[:user_subscription_id] != 1 %>
						<div class="col-xs-4">
							<%= link_to "My Preferences", user_delivery_settings_path, class: "drink-preference-view-option" %>
						</div>
						<div class="col-xs-4">
							<%= link_to 'Delivery Estimate', user_delivery_settings_total_estimate_path, class: "drink-preference-view-option current" %>
						</div>
					<% end %>
					<div class="col-xs-4">
						<%= link_to 'Delivery Location', user_delivery_settings_location_path, class: "drink-preference-view-option" %>
					</div>
				</div>
			</div>
		</div>
	</div>
<div class="row">
	<div class="container">
		<div class="row no-margin">
			<div class="col-sm-8">
				<h4>Total per delivery estimates:</h4>
				<div class="row no-margin">
					<%= render 'user_delivery_estimates_for_customer' %>
				</div>
			</div>	
		</div>
		<hr>
		<% @users.each_with_index do |user, index| %>
			<% @delivery_preferences = DeliveryPreference.where(user_id: user.id).first %>
			<% if !@delivery_preferences.blank? %>
				<div class="row no-margin mate-delivery-preferences-row">
					<div class="col-sm-8">
						<% @drink_per_delivery_calculation = (@delivery_preferences.drinks_per_week * 2.2).round %>
					    <% @large_delivery_estimate = @delivery_preferences.max_large_format %>
					    <% @small_delivery_estimate = @drink_per_delivery_calculation - (@large_delivery_estimate * 2) %>
					    <% @delivery_cost_estimate_low = (((@delivery_preferences.price_estimate.to_f) *0.9).floor / 5).round * 5 %>
					    <% @delivery_cost_estimate_high = ((((@delivery_preferences.price_estimate.to_f) *0.9).ceil * 1.1) / 5).round * 5 %>
						<div class="row no-margin">
							<% if user.id == current_user.id %>
								<h5>Your per delivery estimates:</h5>
							<% else %>
								<h5><%= user.first_name %>'s per delivery estimates:</h5>
							<% end %>
						</div>
						<div class="row no-margin">
							<div class="col-xs-2 preference-estimate-holder">
								<div class="delivery-settings-info-box drinks">
									<p>total drinks</p>
									<h4 class="delivery-preference-prompt">~<%= @drink_per_delivery_calculation %></h4>
								</div>	
							</div>
							<div class="col-xs-2 preference-estimate-holder">
								<div class="delivery-settings-info-box small">
									<p>small</p>
									<h4 class="delivery-preference-prompt"><span class="preference-estimate-signs">><br>=</span>
										<%= @small_delivery_estimate %>
									</h4>
								</div>	
							</div>
							<div class="col-xs-2 preference-estimate-holder">
								<div class="delivery-settings-info-box large">
									<p>large</p>
									<h4 class="delivery-preference-prompt"><span class="preference-estimate-signs"><<br>=</span>
										<%= @large_delivery_estimate %>
									</h4>
								</div>	
							</div>
							<div class="col-xs-3 preference-estimate-holder no-padding-right">
								<div class="delivery-settings-info-box total-price">
									<p>total price <sup  data-toggle="tooltip" title="You always have final say on your delivery, so you'll never be surprised by the actual cost.">?</sup></p>
									<h4 class="delivery-preference-prompt">~<%= number_to_currency(@delivery_cost_estimate_low, precision: 0) %> - <%= number_to_currency(@delivery_cost_estimate_high, precision: 0) %></h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			<% end %>
			<% if index != @users.size - 1 %>
			    <hr>
			<% end %>
		<% end %>
	</div>
</div>
<%= render 'layouts/footer' %>